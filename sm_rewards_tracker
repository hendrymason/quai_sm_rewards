import tweepy

# use this client for read only processes, authentication was not working but appears unnecessary
client = tweepy.Client(bearer_token= "AAAAAAAAAAAAAAAAAAAAAEHkXwEAAAAAFgCxzDEOf484cKicUHiV3DO6qcU%3DodAKdbVDHoucR6dlOzPbB719XrDMisbZAWLufgqORgLCLgKUtO")

# dict to track everything -> {username: [likes, retweets, replies], ...}
sm_rewards = {}

# search recent tweets from quainetwork, minus retweets
query = 'from:quainetwork -is:retweet'
tweets = client.search_recent_tweets(query=query, max_results=100)
tweet_count = 0

#iterate through tweet objects to collect retweeters, likers, and replies and assign user's their respective rewards
for tweet in tweets.data:
    tweet_count += 1
    retweeters = client.get_retweeters(tweet.id)
    likers = client.get_liking_users(tweet.id)
    # print('----------------------')
    # print('tweet text: ' + tweet.text)
    for liker in likers.data:
        if liker.username in sm_rewards:
            sm_rewards[liker.username][0] = sm_rewards[liker.username][0] + 1
        else:
            sm_rewards[liker.username] = [1, 0, 0]
            #print('Added ' + liker.username)
        # print('Liker name: ' + liker.username)
        # print('Total Likes: ' + str(sm_rewards[liker.username][0]))
        # print('Total Retweets: ' + str(sm_rewards[liker.username][1]))
        # print("-- + --")
    for retweeter in retweeters.data:
        if retweeter.username in sm_rewards:
            sm_rewards[retweeter.username][1] = sm_rewards[retweeter.username][1] + 1
        else:
            sm_rewards[retweeter.username] = [0, 1, 0]
            #print('Added ' + retweeter.username)
        # print('Retweeter name: ' + retweeter.username)
        # print('Total Likes: ' + str(sm_rewards[retweeter.username][0]))
        # print('Total Retweets: ' + str(sm_rewards[retweeter.username][1]))
        # print("-- + --")
count = 0
for user in sm_rewards:
    count += 1
    total_rewards = sm_rewards[user][0] + sm_rewards[user][1] + sm_rewards[user][2]
    print(user + "'s Total Likes: " + str(sm_rewards[user][0]))
    print(user + "'s Total Retweets: " + str(sm_rewards[user][1]))
    print(user + "'s Total Rewards: " + str(total_rewards))

print("Total Tweets: " + str(tweet_count))
print("Total Users: " + str(count))

#handle authentication
# api_key = "jzW10D2Z2sIMBolpvuqRBVNxH"
# api_secret_key = "ihDUekm4zpEEFsMFo2c34u594AZV14MhKgNBAXBkRIjIvpJKFx"
# access_token = "2670032257-imtKVNTyO6dPsgFpCZ5Q9jK77GR5NTn6rUlTEZN"
# secret_access_token = "GiFRKG1Tpm1cftWjC9EZhn90krowI8AXyXTFY1YjXT1bd"

# auth = tweepy.OAuthHandler("jzW10D2Z2sIMBolpvuqRBVNxH", "ihDUekm4zpEEFsMFo2c34u594AZV14MhKgNBAXBkRIjIvpJKFx")
# auth.set_access_token("2670032257-imtKVNTyO6dPsgFpCZ5Q9jK77GR5NTn6rUlTEZN", "GiFRKG1Tpm1cftWjC9EZhn90krowI8AXyXTFY1YjXT1bd")


# api = tweepy.API(auth)

# try:
#     api.verify_credentials()
#     print("everything works")
# except:
#     print("something went wrong")
