## {name : [1 $QUAI likes+retweets, 1 $QUAI reply to @quainetwork (with max 2 per day), 5 $QUAI individual tweet about @quainetwork, 
# retweets, likes, and replies to your individual tweet about $QUAI -> 5 $QUAI per 10 engagements]}

import tweepy

# use this client for read only processes, authentication was not working but appears unnecessary
client = tweepy.Client(bearer_token= "AAAAAAAAAAAAAAAAAAAAAEHkXwEAAAAAFgCxzDEOf484cKicUHiV3DO6qcU%3DodAKdbVDHoucR6dlOzPbB719XrDMisbZAWLufgqORgLCLgKUtO")

# dict to track everything -> {username: [likes, retweets, replies], ...}
sm_rewards = {}

# search recent tweets from quainetwork, minus retweets
query = 'from:quainetwork -is:retweet'
tweets = client.search_recent_tweets(query=query, max_results=100)

tweet_count = 0

#iterate through tweet objects to collect retweeters, likers, and replies and assign user's their respective rewards
for tweet in tweets.data:
    tweet_count += 1
    likers_list = []
    retweeters_list = []
    likers_retweeters = []
    likers = client.get_liking_users(tweet.id)
    retweeters = client.get_retweeters(tweet.id)
    # pull username into liker list from likers data
    for liker in likers.data:
        likers_list.append(liker.username)
    # pull username into retweeter list from retweeters data
    for retweeter in retweeters.data:
        retweeters_list.append(retweeter.username)
    # create new list of users who both liked and retweeted
    likers_retweeters = [user for user in likers_list if user in retweeters_list]
    for user in likers_retweeters:
        if user in sm_rewards:
            sm_rewards[user][0] = sm_rewards[user][0] + 1
        else:
            sm_rewards[user] = [1, 0, 0, 0]

# Check reward count for each user and total recent tweet count
for user in sm_rewards:
    total_rewards = sm_rewards[user][0] + sm_rewards[user][1] + sm_rewards[user][2] + sm_rewards[user][3]
    print('Username: ' + user + ' Total Rewards: ' + str(total_rewards))

print('Total Tweets: ' + str(tweet_count))
